# Ruff configuration for NRGkick Home Assistant Integration
# Aligned with Home Assistant core configuration
# https://github.com/home-assistant/core/blob/dev/pyproject.toml

# Target Python 3.13 (Home Assistant 2025.x requirement)
target-version = "py313"

# Line length to match Home Assistant
line-length = 88

# Exclude common directories
exclude = [
    ".git",
    ".venv",
    "venv",
    "__pycache__",
    "htmlcov",
    "releases",
]

[lint]
# Rules aligned with Home Assistant core (dev branch)
select = [
    "A001",   # Variable {name} is shadowing a Python builtin
    "ASYNC",  # flake8-async
    "B002",   # Python does not support the unary prefix increment
    "B005",   # Using .strip() with multi-character strings is misleading
    "B007",   # Loop control variable {name} not used within loop body
    "B009",   # getattr() with constant attribute value
    "B014",   # Exception handler with duplicate exception
    "B015",   # Pointless comparison
    "B017",   # pytest.raises(BaseException) should be considered evil
    "B018",   # Found useless attribute access
    "B023",   # Function definition does not bind loop variable {name}
    "B024",   # Abstract base class without abstract methods/properties
    "B026",   # Star-arg unpacking after a keyword argument
    "B032",   # Possible unintentional type annotation
    "B035",   # Dictionary comprehension uses static key
    "B904",   # Use raise from to specify exception cause
    "B905",   # zip() without explicit strict= parameter
    "BLE",    # flake8-blind-except
    "C",      # complexity
    "COM818", # Trailing comma on bare tuple prohibited
    "D",      # docstrings
    "DTZ003", # datetime.now(tz=) instead of datetime.utcnow()
    "DTZ004", # datetime.fromtimestamp(ts, tz=) instead of utcfromtimestamp
    "E",      # pycodestyle
    "F",      # pyflakes/autoflake
    "F541",   # f-string without any placeholders
    "FLY",    # flynt
    "FURB",   # refurb
    "G",      # flake8-logging-format
    "I",      # isort
    "INP",    # flake8-no-pep420
    "ISC",    # flake8-implicit-str-concat
    "ICN001", # import conventions
    "LOG",    # flake8-logging
    "N804",   # First argument of a class method should be named cls
    "N805",   # First argument of a method should be named self
    "N815",   # Variable {name} in class scope should not be mixedCase
    "PERF",   # Perflint
    "PGH",    # pygrep-hooks
    "PIE",    # flake8-pie
    "PL",     # pylint
    "PT",     # flake8-pytest-style
    "PTH",    # flake8-pathlib
    "PYI",    # flake8-pyi
    "RET",    # flake8-return
    "RSE",    # flake8-raise
    "RUF005", # Consider iterable unpacking instead of concatenation
    "RUF006", # Store a reference to the return value of asyncio.create_task
    "RUF007", # Prefer itertools.pairwise() over zip()
    "RUF008", # Avoid mutable default values for dataclass attributes
    "RUF010", # Use explicit conversion flag
    "RUF013", # PEP 484 prohibits implicit Optional
    "RUF016", # Slice uses type {index_type} instead of an integer
    "RUF017", # Avoid quadratic list summation
    "RUF018", # Avoid assignment expressions in assert statements
    "RUF019", # Unnecessary key check before dictionary access
    "RUF020", # {never_like} | T is equivalent to T
    "RUF021", # Parenthesize boolean expression chaining
    "RUF022", # Sort __all__
    "RUF023", # Sort __slots__
    "RUF024", # Do not pass mutable objects as values to dict.fromkeys
    "RUF026", # default_factory is positional-only for defaultdict
    "RUF030", # print() call in assert statement likely unintentional
    "RUF032", # Decimal() called with float literal argument
    "RUF033", # __post_init__ method with argument defaults
    "RUF034", # Useless if-else condition
    "RUF059", # unused-unpacked-variable
    "RUF100", # Unused noqa directive
    "RUF101", # noqa directives that use redirected rule codes
    "RUF200", # Failed to parse pyproject.toml: {message}
    "S102",   # Use of exec detected
    "S103",   # bad-file-permissions
    "S108",   # hardcoded-temp-file
    "S306",   # suspicious-mktemp-usage
    "S307",   # suspicious-eval-usage
    "S313",   # suspicious-xmlc-element-tree-usage
    "S314",   # suspicious-xml-element-tree-usage
    "S315",   # suspicious-xml-expat-reader-usage
    "S316",   # suspicious-xml-expat-builder-usage
    "S317",   # suspicious-xml-sax-usage
    "S318",   # suspicious-xml-mini-dom-usage
    "S319",   # suspicious-xml-pull-dom-usage
    "S601",   # paramiko-call
    "S602",   # subprocess-popen-with-shell-equals-true
    "S604",   # call-with-shell-equals-true
    "S608",   # hardcoded-sql-expression
    "S609",   # unix-command-wildcard-injection
    "SIM",    # flake8-simplify
    "SLF",    # flake8-self
    "SLOT",   # flake8-slots
    "T100",   # Trace found: {name} used
    "T20",    # flake8-print
    "TC",     # flake8-type-checking
    "TID",    # flake8-tidy-imports
    "TRY",    # tryceratops
    "UP",     # pyupgrade
    "UP031",  # Use format specifiers instead of percent format
    "UP032",  # Use f-string instead of `format` call
    "W",      # pycodestyle warnings
]

ignore = [
    "ASYNC109", # Async function definition with a `timeout` parameter
    "ASYNC110", # Use `asyncio.Event` instead of awaiting `asyncio.sleep`
    "D202",     # No blank lines allowed after function docstring
    "D203",     # 1 blank line required before class docstring
    "D213",     # Multi-line docstring summary should start at the second line
    "D406",     # Section name should end with a newline
    "D407",     # Section name underlining
    "D417",     # Missing argument descriptions in docstring
    "E501",     # line too long
    "PLC1901",  # Empty string falsy simplification false positives
    "PLR0911",  # Too many return statements
    "PLR0912",  # Too many branches
    "PLR0913",  # Too many arguments
    "PLR0915",  # Too many statements
    "PLR2004",  # Magic value used in comparison
    "PLW1641",  # __eq__ without __hash__
    "PLW2901",  # Outer variable overwritten by inner target
    "PT011",    # pytest.raises too broad without match
    "PT018",    # Assertion should be broken down into multiple parts
    "RUF001",   # String contains ambiguous unicode character
    "RUF002",   # Docstring contains ambiguous unicode character
    "RUF003",   # Comment contains ambiguous unicode character
    "RUF015",   # Prefer next(...) over single element slice
    "SIM102",   # Use a single if statement instead of nested if
    "SIM103",   # Return the condition directly
    "SIM108",   # Use ternary operator instead of if-else-block
    "SIM115",   # Use context handler for opening files
    "TC001",    # Type-checking import moves can break pytest.patch
    "TC002",    # Type-checking import moves can break pytest.patch
    "TC003",    # Type-checking import moves can break pytest.patch
    "TC006",    # Quotes for typing.cast generally not necessary
    "TRY003",   # Avoid specifying long messages outside the exception class
    "TRY400",   # Use logging.exception instead of logging.error
    "UP046",    # Non PEP 695 generic class
    "UP047",    # Non PEP 696 generic function
    "UP049",    # Avoid private type parameter names
    "W191",     # May conflict with the formatter
    "E111",     # May conflict with the formatter
    "E114",     # May conflict with the formatter
    "E117",     # May conflict with the formatter
    "D206",     # May conflict with the formatter
    "D300",     # May conflict with the formatter
    "Q",        # May conflict with the formatter
    "COM812",   # May conflict with the formatter
    "COM819",   # May conflict with the formatter
    "PLE0605",  # Ruff doesn't understand type of __all__ from function
    "FURB116",  # Disabled in HA core
]

[lint.flake8-import-conventions.extend-aliases]
voluptuous = "vol"

[lint.flake8-tidy-imports.banned-api]
"async_timeout".msg = "use asyncio.timeout instead"
"pytz".msg = "use zoneinfo instead"
"tests".msg = "You should not import tests"

[lint.isort]
force-sort-within-sections = true
known-first-party = ["homeassistant"]
combine-as-imports = true
split-on-trailing-comma = false

[lint.flake8-pytest-style]
fixture-parentheses = false
mark-parentheses = false

[lint.mccabe]
max-complexity = 25

[lint.per-file-ignores]
# Keep tests pragmatic; align with HA core where possible.
"custom_components/**" = ["PTH"]
"tests/**" = ["PLC0415", "PLR2004", "PTH", "SLF001", "TID251"]

[lint.pydocstyle]
convention = "google"
property-decorators = ["propcache.api.cached_property"]

[format]
quote-style = "double"
indent-style = "space"
line-ending = "lf"
